**************************************
****   Berkeley High Resolution   ****
**** (BEHR) NO2 Product Changelog ****
**************************************

Current maintainer: Josh Laughner (jlaughner@berkeley.edu)

==========
1) Preface
==========

(I) Version numbering system

The BEHR version numbering system combines the OMNO2 version number with an
internal version letter. So, v2.1A represents the first BEHR product based on
version 2.1 of the NASA OMNO2 product. A subsequent version of BEHR still based
on version 2.1 of OMNO2 would be v2.1B. If OMNO2 were to update to version 3,
the BEHR product based on that would be v3.0A.

Should a minor change be made (e.g. one that adds information to the output but
does not change the core algorithm), a revision number will be appended to the
version number. For example, v2.1A and v2.1Arev0 will be the same, but v2.1Arev1
would indicate this sort of minor change.

The version number may also be formatted as, e.g. v2-1A. This is used as the version
string in file names to prevent any issue with file systems unable to handle a . in
a filename that is not separating the file extension. This form is completely
equivalent to the one with the period and is used interchangeably.

============
2) Changelog
============


**** 2.1Arev1 ****
-- Revision only: no substantial changes to the data product itself.
-- File names will now contain the version number for easier tracability.
-- Corrected issue where fill values for cloud fraction fields are divided by 1000. The
   fields CloudFraction and CloudRadianceFraction will now have fill values of -32767
   instead of -32.767.
-- Terrain reflectivity has now been scaled to actually lie between 0 and 1. 
-- All BEHR fields will now use a fill value of -3.402e38 (-realmax('single') in Matlab).
-- Updated some metadata in the HDF files.
-- The .txt files now replace NaNs with fill values for fields that have fill values defined.
-- In the computation of the BEHR AMF, it has always been clamped to a minimum value of 1e-6.
   This is still true; however, the way Matlab treats NaNs meant that a NaN AMF was changed to
   1e-6, when really we would prefer that it remain a NaN as this usually indicates that either
   the scattering weights or a priori profile were all NaNs as well, due to either the inputs
   to the scattering weight lookup table being outside the ranges defined in that table.
   Many cases where the AMF should have remained a NaN were returned to NaNs by a later check
   in the code, however now pixels where the AMF is a NaN are never converted to 1e-6 in the 
   first place. *Note: as long as you have been following the recommendation to remove all VCDs
   >1e17 (as an extra guarentee against including row anomaly pixels), you will notice no change,
   as AMFs of 1e-6 lead to VCDs ~1e20 or greater. 
-- Rarely, cloud pressure may be >1013 hPa. This causes the scattering weight lookup to fail, 
   because the algorithm treats cloud pressure as surface pressure for the cloudy AMF, and the
   lookup table is only defined for surface pressure <= 1013 hPa. Therefore, cloud pressures are
   now clamped to <= 1013 hPa before input to the lookup table.


**** 2.1A ****

-- First version produced by Josh Laughner
-- Updated to OMNO2 version 2.1
-- The field ColumnAmountNO2Initial is no longer available
-- GLOBE terrain height now averaged directly to OMI pixels (no pre-averaging to
~4 km resolution)
-- 400 is no longer a fill value for the GLOBETerpres field. There should be no
fill values in this field - grid points in the GLOBE database that do not have a
value are over ocean, and so are assigned a pressure of 1013 hPa.
-- Corrected bug in which the cloud fractions were scaled twice before
inclusion in AMF calculation. (This had only a minor effect on NO2 columns.)
-- Flag fields (vcdQualityFlags, XTrackQualityFlags) will now represent the most
cautious flag in the gridded product (the flags from all pixels averaged
together for a particular grid cell will be combined using a bitwise OR)
-- Dataset numbers in the HDF may have changed due to the removal of
ColumnAmountNO2Initial from OMNO2 (sorry!). Dataset names should be the same.
-- Added scattering weights, averaging kernels, and the pressure levels for
those quantities.  These are calculated as the average of the clear and cloudy
scattering weights weighted by the radiance cloud fraction.  Both include the OMI
temperature correction for the NO2 cross section.
-- Added the a priori NO2 profiles used for each pixel.  This allows advanced users
to compare the effect of a priori choice with a model of their own choosing.
-- Attributes have been added to the HDF files' variables, including unit, 
range, fill value, product (standard (SP) or BEHR), and a description. Each
swath also has an attribute indicating if it is organized by native pixel or
0.05 x 0.05 deg grid.
-- The quantity represented by BEHRColumnAmountNO2Trop will represent only the
visible NO2 column, and will not include any contribution from the ghost column.
The field BEHRGhostFraction will provide a multiplicative factor to add back in
the ghost column (based on WRF-Chem model runs) if desired.


**** 2.0A ****

-- Final version produced by Ashley Russell
-- Albedo: MODIS MCD43C3 16-day average (every 8 days)
-- Terrain pressure: Global Land One-kilometer Base Elevation (GLOBE) topography
used to calculate surface pressure using scale height relationship. GLOBE data
pre-averaged to 4-km.
-- NO2 profiles calculated for continental US using WRF-Chem at 12 km resolution
using NEI 2005 emissions.
